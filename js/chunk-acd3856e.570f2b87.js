(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-acd3856e"],{"5e7e":function(e,t,r){"use strict";r.d(t,"b",(function(){return d})),r.d(t,"a",(function(){return g}));var n={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},i=r("da5c"),a=r("1300"),o="\n  precision mediump float;\n  \n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n  \n  uniform vec2 u_screenSize;\n   \n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n",s="\n  precision mediump float;\n   \n  uniform sampler2D u_image;\n  uniform float u_opacity;\n   \n  varying vec2 v_texCoord;\n   \n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n  }\n",u=function(){function e(e){this.gl_=e.webGlContext;var t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer();var r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e.vertexShader||o),t.compileShader(r);var n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e.fragmentShader||s),t.compileShader(n),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,r),t.attachShader(this.renderTargetProgram_,n),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();var i=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(function(r){this.uniforms_.push({value:e.uniforms[r],location:t.getUniformLocation(this.renderTargetProgram_,r)})}.bind(this))}return e.prototype.getGL=function(){return this.gl_},e.prototype.init=function(e){var t=this.getGL(),r=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;var n=0,i=t.RGBA,a=0,o=t.RGBA,s=t.UNSIGNED_BYTE,u=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,n,i,r[0],r[1],a,o,s,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0)}},e.prototype.apply=function(e,t,r,n){var i=this.getGL(),o=e.size;if(i.bindFramebuffer(i.FRAMEBUFFER,t?t.getFrameBuffer():null),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.renderTargetTexture_),!t){var s=Object(a["c"])(i.canvas);if(!e.renderTargets[s]){var u=i.getContextAttributes();u&&u.preserveDrawingBuffer&&(i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT)),e.renderTargets[s]=!0}}i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),i.bindBuffer(i.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),i.useProgram(this.renderTargetProgram_),i.enableVertexAttribArray(this.renderTargetAttribLocation_),i.vertexAttribPointer(this.renderTargetAttribLocation_,2,i.FLOAT,!1,0,0),i.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),i.uniform1i(this.renderTargetTextureLocation_,0);var c=e.layerStatesArray[e.layerIndex].opacity;i.uniform1f(this.renderTargetOpacityLocation_,c),this.applyUniforms(e),r&&r(i,e),i.drawArrays(i.TRIANGLES,0,6),n&&n(i,e)},e.prototype.getFrameBuffer=function(){return this.frameBuffer_},e.prototype.applyUniforms=function(e){var t,r=this.getGL(),n=1;this.uniforms_.forEach((function(i){if(t="function"===typeof i.value?i.value(e):i.value,t instanceof HTMLCanvasElement||t instanceof ImageData)i.texture||(i.texture=r.createTexture()),r.activeTexture(r["TEXTURE"+n]),r.bindTexture(r.TEXTURE_2D,i.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),t instanceof ImageData?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,t.width,t.height,0,r.UNSIGNED_BYTE,new Uint8Array(t.data)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),r.uniform1i(i.location,n++);else if(Array.isArray(t))switch(t.length){case 2:return void r.uniform2f(i.location,t[0],t[1]);case 3:return void r.uniform3f(i.location,t[0],t[1],t[2]);case 4:return void r.uniform4f(i.location,t[0],t[1],t[2],t[3]);default:return}else"number"===typeof t&&r.uniform1f(i.location,t)}))},e}(),c=u,h=r("86e0"),f=r("38f3"),_=r("a896"),p=r("be6c"),l=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),d={PROJECTION_MATRIX:"u_projectionMatrix",OFFSET_SCALE_MATRIX:"u_offsetScaleMatrix",OFFSET_ROTATION_MATRIX:"u_offsetRotateMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution"},g={UNSIGNED_BYTE:h["g"],UNSIGNED_SHORT:h["i"],UNSIGNED_INT:h["h"],FLOAT:h["d"]},m={};function E(e){return"shared/"+e}var T=0;function v(){var e="unique/"+T;return T+=1,e}function b(e){var t=m[e];if(!t){var r=document.createElement("canvas");r.style.position="absolute",r.style.left="0",t={users:0,canvas:r},m[e]=t}return t.users+=1,t.canvas}function y(e){var t=m[e];if(t&&(t.users-=1,!(t.users>0))){var r=t.canvas,n=Object(h["j"])(r),i=n.getExtension("WEBGL_lose_context");i&&i.loseContext(),delete m[e]}}var R=function(e){function t(t){var r=e.call(this)||this,i=t||{};r.boundHandleWebGLContextLost_=r.handleWebGLContextLost.bind(r),r.boundHandleWebGLContextRestored_=r.handleWebGLContextRestored.bind(r),r.canvasCacheKey_=i.canvasCacheKey?E(i.canvasCacheKey):v(),r.canvas_=b(r.canvasCacheKey_),r.gl_=Object(h["j"])(r.canvas_),r.bufferCache_={},r.extensionCache_={},r.currentProgram_=null,r.canvas_.addEventListener(n.LOST,r.boundHandleWebGLContextLost_),r.canvas_.addEventListener(n.RESTORED,r.boundHandleWebGLContextRestored_),r.offsetRotateMatrix_=Object(_["c"])(),r.offsetScaleMatrix_=Object(_["c"])(),r.tmpMat4_=Object(p["a"])(),r.uniformLocations_={},r.attribLocations_={},r.uniforms_=[],i.uniforms&&r.setUniforms(i.uniforms);var a=r.getGL();return r.postProcessPasses_=i.postProcesses?i.postProcesses.map((function(e){return new c({webGlContext:a,scaleRatio:e.scaleRatio,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms})})):[new c({webGlContext:a})],r.shaderCompileErrors_=null,r.startTime_=Date.now(),r}return l(t,e),t.prototype.setUniforms=function(e){for(var t in this.uniforms_=[],e)this.uniforms_.push({name:t,value:e[t]});this.uniformLocations_={}},t.prototype.canvasCacheKeyMatches=function(e){return this.canvasCacheKey_===E(e)},t.prototype.getExtension=function(e){if(e in this.extensionCache_)return this.extensionCache_[e];var t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t},t.prototype.bindBuffer=function(e){var t=this.getGL(),r=Object(a["c"])(e),n=this.bufferCache_[r];if(!n){var i=t.createBuffer();n={buffer:e,webGlBuffer:i},this.bufferCache_[r]=n}t.bindBuffer(e.getType(),n.webGlBuffer)},t.prototype.flushBufferData=function(e){var t=this.getGL();this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())},t.prototype.deleteBuffer=function(e){var t=this.getGL(),r=Object(a["c"])(e),n=this.bufferCache_[r];n&&!t.isContextLost()&&t.deleteBuffer(n.webGlBuffer),delete this.bufferCache_[r]},t.prototype.disposeInternal=function(){this.canvas_.removeEventListener(n.LOST,this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(n.RESTORED,this.boundHandleWebGLContextRestored_),y(this.canvasCacheKey_),delete this.gl_,delete this.canvas_},t.prototype.prepareDraw=function(e,t){var r=this.getGL(),n=this.getCanvas(),i=e.size,a=e.pixelRatio;n.width=i[0]*a,n.height=i[1]*a,n.style.width=i[0]+"px",n.style.height=i[1]+"px",r.useProgram(this.currentProgram_);for(var o=this.postProcessPasses_.length-1;o>=0;o--)this.postProcessPasses_[o].init(e);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,t?r.ZERO:r.ONE_MINUS_SRC_ALPHA),r.useProgram(this.currentProgram_),this.applyFrameState(e),this.applyUniforms(e)},t.prototype.prepareDrawToRenderTarget=function(e,t,r){var n=this.getGL(),i=t.getSize();n.bindFramebuffer(n.FRAMEBUFFER,t.getFramebuffer()),n.viewport(0,0,i[0],i[1]),n.bindTexture(n.TEXTURE_2D,t.getTexture()),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,r?n.ZERO:n.ONE_MINUS_SRC_ALPHA),n.useProgram(this.currentProgram_),this.applyFrameState(e),this.applyUniforms(e)},t.prototype.drawElements=function(e,t){var r=this.getGL();this.getExtension("OES_element_index_uint");var n=r.UNSIGNED_INT,i=4,a=t-e,o=e*i;r.drawElements(r.TRIANGLES,a,n,o)},t.prototype.finalizeDraw=function(e,t,r){for(var n=0,i=this.postProcessPasses_.length;n<i;n++)n===i-1?this.postProcessPasses_[n].apply(e,null,t,r):this.postProcessPasses_[n].apply(e,this.postProcessPasses_[n+1])},t.prototype.getCanvas=function(){return this.canvas_},t.prototype.getGL=function(){return this.gl_},t.prototype.applyFrameState=function(e){var t=e.size,r=e.viewState.rotation,n=Object(_["g"])(this.offsetScaleMatrix_);Object(_["i"])(n,2/t[0],2/t[1]);var i=Object(_["g"])(this.offsetRotateMatrix_);0!==r&&Object(_["h"])(i,-r),this.setUniformMatrixValue(d.OFFSET_SCALE_MATRIX,Object(p["b"])(this.tmpMat4_,n)),this.setUniformMatrixValue(d.OFFSET_ROTATION_MATRIX,Object(p["b"])(this.tmpMat4_,i)),this.setUniformFloatValue(d.TIME,.001*(Date.now()-this.startTime_)),this.setUniformFloatValue(d.ZOOM,e.viewState.zoom),this.setUniformFloatValue(d.RESOLUTION,e.viewState.resolution)},t.prototype.applyUniforms=function(e){var t,r=this.getGL(),n=0;this.uniforms_.forEach(function(i){if(t="function"===typeof i.value?i.value(e):i.value,t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof ImageData){i.texture||(i.prevValue=void 0,i.texture=r.createTexture()),r.activeTexture(r["TEXTURE"+n]),r.bindTexture(r.TEXTURE_2D,i.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);var a=!(t instanceof HTMLImageElement)||t.complete;a&&i.prevValue!==t&&(i.prevValue=t,r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)),r.uniform1i(this.getUniformLocation(i.name),n++)}else if(Array.isArray(t)&&6===t.length)this.setUniformMatrixValue(i.name,Object(p["b"])(this.tmpMat4_,t));else if(Array.isArray(t)&&t.length<=4)switch(t.length){case 2:return void r.uniform2f(this.getUniformLocation(i.name),t[0],t[1]);case 3:return void r.uniform3f(this.getUniformLocation(i.name),t[0],t[1],t[2]);case 4:return void r.uniform4f(this.getUniformLocation(i.name),t[0],t[1],t[2],t[3]);default:return}else"number"===typeof t&&r.uniform1f(this.getUniformLocation(i.name),t)}.bind(this))},t.prototype.useProgram=function(e){if(e==this.currentProgram_)return!1;var t=this.getGL();return t.useProgram(e),this.currentProgram_=e,this.uniformLocations_={},this.attribLocations_={},!0},t.prototype.compileShader=function(e,t){var r=this.getGL(),n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),n},t.prototype.getProgram=function(e,t){var r=this.getGL(),n=this.compileShader(e,r.FRAGMENT_SHADER),i=this.compileShader(t,r.VERTEX_SHADER),a=r.createProgram();if(r.attachShader(a,n),r.attachShader(a,i),r.linkProgram(a),!r.getShaderParameter(n,r.COMPILE_STATUS)){var o="Fragment shader compliation failed: "+r.getShaderInfoLog(n);throw new Error(o)}if(r.deleteShader(n),!r.getShaderParameter(i,r.COMPILE_STATUS)){o="Vertex shader compilation failed: "+r.getShaderInfoLog(i);throw new Error(o)}if(r.deleteShader(i),!r.getProgramParameter(a,r.LINK_STATUS)){o="GL program linking failed: "+r.getShaderInfoLog(i);throw new Error(o)}return a},t.prototype.getUniformLocation=function(e){return void 0===this.uniformLocations_[e]&&(this.uniformLocations_[e]=this.getGL().getUniformLocation(this.currentProgram_,e)),this.uniformLocations_[e]},t.prototype.getAttributeLocation=function(e){return void 0===this.attribLocations_[e]&&(this.attribLocations_[e]=this.getGL().getAttribLocation(this.currentProgram_,e)),this.attribLocations_[e]},t.prototype.makeProjectionTransform=function(e,t){var r=e.size,n=e.viewState.rotation,i=e.viewState.resolution,a=e.viewState.center;return Object(_["g"])(t),Object(_["b"])(t,0,0,2/(i*r[0]),2/(i*r[1]),-n,-a[0],-a[1]),t},t.prototype.setUniformFloatValue=function(e,t){this.getGL().uniform1f(this.getUniformLocation(e),t)},t.prototype.setUniformMatrixValue=function(e,t){this.getGL().uniformMatrix4fv(this.getUniformLocation(e),!1,t)},t.prototype.enableAttributeArray_=function(e,t,r,n,i){var a=this.getAttributeLocation(e);a<0||(this.getGL().enableVertexAttribArray(a),this.getGL().vertexAttribPointer(a,t,r,!1,n,i))},t.prototype.enableAttributes=function(e){for(var t=A(e),r=0,n=0;n<e.length;n++){var i=e[n];this.enableAttributeArray_(i.name,i.size,i.type||h["d"],t,r),r+=i.size*x(i.type)}},t.prototype.handleWebGLContextLost=function(){Object(f["b"])(this.bufferCache_),this.currentProgram_=null},t.prototype.handleWebGLContextRestored=function(){},t.prototype.createTexture=function(e,t,r){var n=this.getGL(),i=r||n.createTexture(),a=0,o=n.RGBA,s=0,u=n.RGBA,c=n.UNSIGNED_BYTE;return n.bindTexture(n.TEXTURE_2D,i),t?n.texImage2D(n.TEXTURE_2D,a,o,u,c,t):n.texImage2D(n.TEXTURE_2D,a,o,e[0],e[1],s,u,c,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),i},t}(i["a"]);function A(e){for(var t=0,r=0;r<e.length;r++){var n=e[r];t+=n.size*x(n.type)}return t}function x(e){switch(e){case g.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case g.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case g.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case g.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}t["c"]=R},"7fd1":function(e,t,r){"use strict";(function(e){function n(){var t='var e="function"==typeof Object.assign?Object.assign:function(e,n){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1,o=arguments.length;r<o;++r){var i=arguments[r];if(null!=i)for(var f in i)i.hasOwnProperty(f)&&(t[f]=i[f])}return t},n="GENERATE_BUFFERS",t=[],r={vertexPosition:0,indexPosition:0};function o(e,n,t,r,o){e[n+0]=t,e[n+1]=r,e[n+2]=o}function i(e,n,i,f,s,u){var a=3+s,l=e[n+0],v=e[n+1],c=t;c.length=s;for(var g=0;g<c.length;g++)c[g]=e[n+2+g];var b=u?u.vertexPosition:0,h=u?u.indexPosition:0,d=b/a;return o(i,b,l,v,0),c.length&&i.set(c,b+3),o(i,b+=a,l,v,1),c.length&&i.set(c,b+3),o(i,b+=a,l,v,2),c.length&&i.set(c,b+3),o(i,b+=a,l,v,3),c.length&&i.set(c,b+3),b+=a,f[h++]=d,f[h++]=d+1,f[h++]=d+3,f[h++]=d+1,f[h++]=d+2,f[h++]=d+3,r.vertexPosition=b,r.indexPosition=h,r}var f=self;f.onmessage=function(t){var r=t.data;if(r.type===n){for(var o=r.customAttributesCount,s=2+o,u=new Float32Array(r.renderInstructions),a=u.length/s,l=4*a*(o+3),v=new Uint32Array(6*a),c=new Float32Array(l),g=null,b=0;b<u.length;b+=s)g=i(u,b,c,v,o,g);var h=e({vertexBuffer:c.buffer,indexBuffer:v.buffer,renderInstructions:u.buffer},r);f.postMessage(h,[c.buffer,v.buffer,u.buffer])}};';return new Worker("undefined"===typeof Blob?"data:application/javascript;base64,"+e.from(t,"binary").toString("base64"):URL.createObjectURL(new Blob([t],{type:"application/javascript"})))}r.d(t,"a",(function(){return n}))}).call(this,r("b639").Buffer)},"86e0":function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"c",(function(){return a})),r.d(t,"f",(function(){return o})),r.d(t,"e",(function(){return s})),r.d(t,"b",(function(){return u})),r.d(t,"g",(function(){return c})),r.d(t,"i",(function(){return h})),r.d(t,"h",(function(){return f})),r.d(t,"d",(function(){return _})),r.d(t,"j",(function(){return l}));var n=r("38f3"),i=34962,a=34963,o=35040,s=35044,u=35048,c=5121,h=5123,f=5125,_=5126,p=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function l(e,t){for(var r=Object(n["a"])({preserveDrawingBuffer:!0},t),i=p.length,a=0;a<i;++a)try{var o=e.getContext(p[a],r);if(o)return o}catch(s){}return null}},aab2:function(e,t,r){"use strict";var n=r("86e0"),i=r("92fa5"),a={STATIC_DRAW:n["e"],STREAM_DRAW:n["f"],DYNAMIC_DRAW:n["b"]},o=function(){function e(e,t){this.array=null,this.type=e,Object(i["a"])(e===n["a"]||e===n["c"],62),this.usage=void 0!==t?t:a.STATIC_DRAW}return e.prototype.ofSize=function(e){this.array=new(s(this.type))(e)},e.prototype.fromArray=function(e){var t=s(this.type);this.array=t.from?t.from(e):new t(e)},e.prototype.fromArrayBuffer=function(e){this.array=new(s(this.type))(e)},e.prototype.getType=function(){return this.type},e.prototype.getArray=function(){return this.array},e.prototype.getUsage=function(){return this.usage},e.prototype.getSize=function(){return this.array?this.array.length:0},e}();function s(e){switch(e){case n["a"]:return Float32Array;case n["c"]:return Uint32Array;default:return Float32Array}}t["a"]=o},ac3a:function(e,t,r){"use strict";var n=r("ae50"),i=r("f623"),a=r("a43f"),o=r("496f"),s=r("aab2"),u=r("cae5"),c=r("9f5e"),h=new Uint8Array(4),f=function(){function e(e,t){this.helper_=e;var r=e.getGL();this.texture_=r.createTexture(),this.framebuffer_=r.createFramebuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}return e.prototype.setSize=function(e){Object(c["b"])(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())},e.prototype.getSize=function(){return this.size_},e.prototype.clearCachedData=function(){this.dataCacheDirty_=!0},e.prototype.readAll=function(){if(this.dataCacheDirty_){var e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_},e.prototype.readPixel=function(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return h[0]=0,h[1]=0,h[2]=0,h[3]=0,h;this.readAll();var r=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return h[0]=this.data_[4*r],h[1]=this.data_[4*r+1],h[2]=this.data_[4*r+2],h[3]=this.data_[4*r+3],h},e.prototype.getTexture=function(){return this.texture_},e.prototype.getFramebuffer=function(){return this.framebuffer_},e.prototype.updateSize_=function(){var e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),this.data_=new Uint8Array(e[0]*e[1]*4)},e}(),_=f,p=r("86e0"),l=r("5e7e"),d=r("a896"),g=r("92fa5"),m=r("0af5"),E=r("7fd1"),T=r("1300"),v=r("1e8d"),b=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),y=function(e){function t(t,r){var n=this,i=r.uniforms||{},o=Object(d["c"])();i[l["b"].PROJECTION_MATRIX]=o,n=e.call(this,t,{uniforms:i,postProcesses:r.postProcesses})||this,n.sourceRevision_=-1,n.verticesBuffer_=new s["a"](p["a"],p["b"]),n.hitVerticesBuffer_=new s["a"](p["a"],p["b"]),n.indicesBuffer_=new s["a"](p["c"],p["b"]),n.vertexShader_=r.vertexShader,n.fragmentShader_=r.fragmentShader,n.program_,n.hitDetectionEnabled_=!(!r.hitFragmentShader||!r.hitVertexShader),n.hitVertexShader_=r.hitVertexShader,n.hitFragmentShader_=r.hitFragmentShader,n.hitProgram_;var c=r.attributes?r.attributes.map((function(e){return{name:"a_"+e.name,size:1,type:l["a"].FLOAT}})):[];n.attributes=[{name:"a_position",size:2,type:l["a"].FLOAT},{name:"a_index",size:1,type:l["a"].FLOAT}].concat(c),n.hitDetectionAttributes=[{name:"a_position",size:2,type:l["a"].FLOAT},{name:"a_index",size:1,type:l["a"].FLOAT},{name:"a_hitColor",size:4,type:l["a"].FLOAT},{name:"a_featureUid",size:1,type:l["a"].FLOAT}].concat(c),n.customAttributes=r.attributes?r.attributes:[],n.previousExtent_=Object(m["j"])(),n.currentTransform_=o,n.renderTransform_=Object(d["c"])(),n.invertRenderTransform_=Object(d["c"])(),n.renderInstructions_=new Float32Array(0),n.hitRenderInstructions_=new Float32Array(0),n.hitRenderTarget_,n.worker_=Object(E["a"])(),n.worker_.addEventListener("message",function(e){var t=e.data;if(t.type===u["a"].GENERATE_BUFFERS){var r=t.projectionTransform;t.hitDetection?(this.hitVerticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.hitVerticesBuffer_)):(this.verticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_)),this.indicesBuffer_.fromArrayBuffer(t.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=r,Object(d["d"])(this.invertRenderTransform_,this.renderTransform_),t.hitDetection?this.hitRenderInstructions_=new Float32Array(e.data.renderInstructions):this.renderInstructions_=new Float32Array(e.data.renderInstructions),this.getLayer().changed()}}.bind(n)),n.featureCache_={},n.featureCount_=0;var h=n.getLayer().getSource();return n.sourceListenKeys_=[Object(v["a"])(h,a["a"].ADDFEATURE,n.handleSourceFeatureAdded_,n),Object(v["a"])(h,a["a"].CHANGEFEATURE,n.handleSourceFeatureChanged_,n),Object(v["a"])(h,a["a"].REMOVEFEATURE,n.handleSourceFeatureDelete_,n),Object(v["a"])(h,a["a"].CLEAR,n.handleSourceFeatureClear_,n)],h.forEachFeature(function(e){this.featureCache_[Object(T["c"])(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}.bind(n)),n}return b(t,e),t.prototype.afterHelperCreated=function(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitProgram_=this.helper.getProgram(this.hitFragmentShader_,this.hitVertexShader_),this.hitRenderTarget_=new _(this.helper))},t.prototype.handleSourceFeatureAdded_=function(e){var t=e.feature;this.featureCache_[Object(T["c"])(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++},t.prototype.handleSourceFeatureChanged_=function(e){var t=e.feature;this.featureCache_[Object(T["c"])(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}},t.prototype.handleSourceFeatureDelete_=function(e){var t=e.feature;delete this.featureCache_[Object(T["c"])(t)],this.featureCount_--},t.prototype.handleSourceFeatureClear_=function(){this.featureCache_={},this.featureCount_=0},t.prototype.renderFrame=function(e){var t=this.helper.getGL();this.preRender(t,e);var r=this.indicesBuffer_.getSize();this.helper.drawElements(0,r),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);var n=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderHitDetection(e),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),n},t.prototype.prepareFrameInternal=function(e){var t=this.getLayer(),r=t.getSource(),i=e.viewState,a=!e.viewHints[o["a"].ANIMATING]&&!e.viewHints[o["a"].INTERACTING],s=!Object(m["o"])(this.previousExtent_,e.extent),u=this.sourceRevision_<r.getRevision();if(u&&(this.sourceRevision_=r.getRevision()),a&&(s||u)){var c=i.projection,h=i.resolution,f=t instanceof n["a"]?t.getRenderBuffer():0,_=Object(m["c"])(e.extent,f*h);r.loadFeatures(_,h,c),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.makeProjectionTransform(e,this.currentTransform_),Object(d["f"])(this.currentTransform_,this.invertRenderTransform_),this.helper.useProgram(this.program_),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0},t.prototype.rebuildBuffers_=function(e){var t=Object(d["c"])();this.helper.makeProjectionTransform(e,t);var r,n,a=(2+this.customAttributes.length)*this.featureCount_;if(this.renderInstructions_&&this.renderInstructions_.length===a||(this.renderInstructions_=new Float32Array(a)),this.hitDetectionEnabled_){var o=(7+this.customAttributes.length)*this.featureCount_;this.hitRenderInstructions_&&this.hitRenderInstructions_.length===o||(this.hitRenderInstructions_=new Float32Array(o))}var s,c=[],h=[],f=0,_=0;for(var p in this.featureCache_)if(r=this.featureCache_[p],n=r.geometry,n&&n.getType()===i["a"].POINT){c[0]=n.getFlatCoordinates()[0],c[1]=n.getFlatCoordinates()[1],Object(d["a"])(t,c),s=Object(u["c"])(_+6,h),this.renderInstructions_[f++]=c[0],this.renderInstructions_[f++]=c[1],this.hitDetectionEnabled_&&(this.hitRenderInstructions_[_++]=c[0],this.hitRenderInstructions_[_++]=c[1],this.hitRenderInstructions_[_++]=s[0],this.hitRenderInstructions_[_++]=s[1],this.hitRenderInstructions_[_++]=s[2],this.hitRenderInstructions_[_++]=s[3],this.hitRenderInstructions_[_++]=Number(p));for(var l=void 0,g=0;g<this.customAttributes.length;g++)l=this.customAttributes[g].callback(r.feature,r.properties),this.renderInstructions_[f++]=l,this.hitDetectionEnabled_&&(this.hitRenderInstructions_[_++]=l)}var m={type:u["a"].GENERATE_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesCount:this.customAttributes.length};if(m["projectionTransform"]=t,this.worker_.postMessage(m,[this.renderInstructions_.buffer]),this.renderInstructions_=null,this.hitDetectionEnabled_){var E={type:u["a"].GENERATE_BUFFERS,renderInstructions:this.hitRenderInstructions_.buffer,customAttributesCount:5+this.customAttributes.length};E["projectionTransform"]=t,E["hitDetection"]=!0,this.worker_.postMessage(E,[this.hitRenderInstructions_.buffer]),this.hitRenderInstructions_=null}},t.prototype.forEachFeatureAtCoordinate=function(e,t,r,n,i){if(Object(g["a"])(this.hitDetectionEnabled_,66),this.hitRenderInstructions_){var a=Object(d["a"])(t.coordinateToPixelTransform,e.slice()),o=this.hitRenderTarget_.readPixel(a[0]/2,a[1]/2),s=[o[0]/255,o[1]/255,o[2]/255,o[3]/255],c=Object(u["b"])(s),h=this.hitRenderInstructions_[c],f=Math.floor(h).toString(),_=this.getLayer().getSource(),p=_.getFeatureByUid(f);return p?n(p,this.getLayer(),null):void 0}},t.prototype.renderHitDetection=function(e){if(this.hitVerticesBuffer_.getSize()){this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.useProgram(this.hitProgram_),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0),this.helper.bindBuffer(this.hitVerticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.hitDetectionAttributes);var t=this.indicesBuffer_.getSize();this.helper.drawElements(0,t)}},t.prototype.disposeInternal=function(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach((function(e){Object(v["c"])(e)})),this.sourceListenKeys_=null,e.prototype.disposeInternal.call(this)},t}(u["d"]);t["a"]=y},be6c:function(e,t,r){"use strict";function n(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function i(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}))},cae5:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"c",(function(){return p})),r.d(t,"b",(function(){return l}));var n=r("df4c"),i=r("faf4"),a=r("3333"),o=r("070d"),s=r("5e7e"),u=r("a896"),c=r("0af5"),h=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),f={GENERATE_BUFFERS:"GENERATE_BUFFERS"},_=function(e){function t(t,r){var i=e.call(this,t)||this,a=r||{};return i.inversePixelTransform_=Object(u["c"])(),i.pixelContext_=null,i.postProcesses_=a.postProcesses,i.uniforms_=a.uniforms,i.helper,t.addChangeListener(n["a"].MAP,i.removeHelper_.bind(i)),i.dispatchPreComposeEvent=i.dispatchPreComposeEvent.bind(i),i.dispatchPostComposeEvent=i.dispatchPostComposeEvent.bind(i),i}return h(t,e),t.prototype.dispatchPreComposeEvent=function(e,t){var r=this.getLayer();if(r.hasListener(o["a"].PRECOMPOSE)){var n=new a["a"](o["a"].PRECOMPOSE,void 0,t,e);r.dispatchEvent(n)}},t.prototype.dispatchPostComposeEvent=function(e,t){var r=this.getLayer();if(r.hasListener(o["a"].POSTCOMPOSE)){var n=new a["a"](o["a"].POSTCOMPOSE,void 0,t,e);r.dispatchEvent(n)}},t.prototype.reset=function(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)},t.prototype.removeHelper_=function(){this.helper&&(this.helper.dispose(),delete this.helper)},t.prototype.prepareFrame=function(e){if(this.getLayer().getSource()){for(var r=!0,n=-1,i=void 0,a=0,o=e.layerStatesArray.length;a<o;a++){var u=e.layerStatesArray[a].layer,c=u.getRenderer();if(c instanceof t){var h=u.getClassName();if((r||h!==i)&&(n+=1,r=!1),i=h,c===this)break}else r=!0}var f="map/"+e.mapId+"/group/"+n;this.helper&&this.helper.canvasCacheKeyMatches(f)||(this.helper&&this.helper.dispose(),this.helper=new s["c"]({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:f}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(e)},t.prototype.afterHelperCreated=function(){},t.prototype.prepareFrameInternal=function(e){return!0},t.prototype.disposeInternal=function(){this.removeHelper_(),e.prototype.disposeInternal.call(this)},t.prototype.dispatchRenderEvent_=function(e,t,r){var n=this.getLayer();if(n.hasListener(e)){Object(u["b"])(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);var i=new a["a"](e,this.inversePixelTransform_,r,t);n.dispatchEvent(i)}},t.prototype.preRender=function(e,t){this.dispatchRenderEvent_(o["a"].PRERENDER,e,t)},t.prototype.postRender=function(e,t){this.dispatchRenderEvent_(o["a"].POSTRENDER,e,t)},t.prototype.getDataAtPixel=function(e,t,r){var n=Object(u["a"])([t.pixelRatio,0,0,t.pixelRatio,0,0],e.slice()),i=this.helper.getGL();if(!i)return null;var a=this.getLayer(),o=a.getExtent();if(o){var s=Object(u["a"])(t.pixelToCoordinateTransform,e.slice());if(!Object(c["f"])(o,s))return null}var h=i.getContextAttributes();if(!h||!h.preserveDrawingBuffer)return new Uint8Array;var f,_=Math.round(n[0]),p=Math.round(n[1]),l=this.pixelContext_;if(!l){var d=document.createElement("canvas");d.width=1,d.height=1,l=d.getContext("2d"),this.pixelContext_=l}l.clearRect(0,0,1,1);try{l.drawImage(i.canvas,_,p,1,1,0,0,1,1),f=l.getImageData(0,0,1,1).data}catch(g){return f}return 0===f[3]?null:f},t}(i["a"]);function p(e,t){var r=t||[],n=256,i=n-1;return r[0]=Math.floor(e/n/n/n)/i,r[1]=Math.floor(e/n/n)%n/i,r[2]=Math.floor(e/n)%n/i,r[3]=e%n/i,r}function l(e){var t=0,r=256,n=r-1;return t+=Math.round(e[0]*r*r*r*n),t+=Math.round(e[1]*r*r*n),t+=Math.round(e[2]*r*n),t+=Math.round(e[3]*n),t}t["d"]=_}}]);